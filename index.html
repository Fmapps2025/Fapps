<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuenta Atrás de Horas Laborables</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para la fuente Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-600 to-emerald-800 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white bg-opacity-90 p-8 rounded-3xl shadow-2xl text-center max-w-xl w-full transform transition-all duration-500 hover:scale-105">
        <h1 class="text-5xl md:text-6xl font-extrabold text-gray-900 mb-6 leading-tight">
            Cuenta Atrás de Vacaciones
        </h1>
        <p class="text-xl md:text-2xl text-gray-700 mb-8">
            Horas laborables restantes hasta el 25 de julio de 2025 a las 15:15
        </p>
        <div id="countdown" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-8">
            <div class="bg-green-700 text-white p-4 rounded-xl shadow-lg flex flex-col items-center justify-center transform hover:scale-105 transition-transform duration-300">
                <span id="hours" class="text-4xl md:text-5xl font-bold">00</span>
                <span class="text-sm md:text-base mt-1">Horas</span>
            </div>
            <div class="bg-green-700 text-white p-4 rounded-xl shadow-lg flex flex-col items-center justify-center transform hover:scale-105 transition-transform duration-300">
                <span id="minutes" class="text-4xl md:text-5xl font-bold">00</span>
                <span class="text-sm md:text-base mt-1">Minutos</span>
            </div>
            <div class="bg-green-700 text-white p-4 rounded-xl shadow-lg flex flex-col items-center justify-center transform hover:scale-105 transition-transform duration-300">
                <span id="seconds" class="text-4xl md:text-5xl font-bold">00</span>
                <span class="text-sm md:text-base mt-1">Segundos</span>
            </div>
            <div class="bg-green-700 text-white p-4 rounded-xl shadow-lg flex flex-col items-center justify-center transform hover:scale-105 transition-transform duration-300">
                <span id="tenths" class="text-4xl md:text-5xl font-bold">0</span>
                <span class="text-sm md:text-base mt-1">Décimas</span>
            </div>
        </div>
        <div id="message" class="text-2xl font-semibold text-green-600 hidden">
            </div>

        <button id="generateIdeasBtn" class="mt-8 px-6 py-3 bg-teal-500 text-white font-bold rounded-xl shadow-lg hover:bg-teal-600 transition-colors duration-300 transform hover:scale-105 hidden">
            ✨ Generar Ideas de Celebración ✨
        </button>
        <div id="ideasContainer" class="mt-6 text-left hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Ideas para celebrar:</h2>
            <div id="ideasOutput" class="bg-gray-100 p-4 rounded-lg text-gray-700">
                <p id="loadingIndicator" class="text-center text-gray-500 hidden">Cargando ideas...</p>
            </div>
        </div>
    </div>

    <script>
        [cite_start]// La fecha y hora de destino para la cuenta atrás (25 de julio de 2025, 15:15:00) [cite: 11]
        [cite_start]const targetDate = new Date("Jul 25, 2025 15:15:00").getTime(); [cite: 11]
        // Obtener los elementos HTML donde se mostrará la cuenta atrás
        [cite_start]const hoursEl = document.getElementById("hours"); [cite: 12]
        [cite_start]const minutesEl = document.getElementById("minutes"); [cite: 13]
        [cite_start]const secondsEl = document.getElementById("seconds"); [cite: 13]
        [cite_start]const tenthsEl = document.getElementById("tenths"); [cite: 13, 14]
        // Nuevo elemento para décimas de segundo
        [cite_start]const messageEl = document.getElementById("message"); [cite: 14]
        [cite_start]const countdownEl = document.getElementById("countdown"); [cite: 15]
        [cite_start]const generateIdeasBtn = document.getElementById("generateIdeasBtn"); [cite: 15]
        [cite_start]const ideasContainer = document.getElementById("ideasContainer"); [cite: 15]
        [cite_start]const ideasOutput = document.getElementById("ideasOutput"); [cite: 15]
        [cite_start]const loadingIndicator = document.getElementById("loadingIndicator"); [cite: 15]
        [cite_start]// Define los turnos de trabajo para cada día de la semana [cite: 16]
        // 0 = Domingo, 1 = Lunes, ..., 6 = Sábado
        const workingShifts = {
            [cite_start]1: [{ start: '07:30', end: '13:20' }, { start: '15:20', end: '18:00' }], // Lunes [cite: 16]
            [cite_start]2: [{ start: '07:30', end: '13:20' }, { start: '15:20', end: '18:00' }], // Martes [cite: 17]
            [cite_start]3: [{ start: '07:30', end: '13:20' }, { start: '15:20', end: '18:00' }], // Miércoles [cite: 17]
            [cite_start]4: [{ start: '07:30', end: '13:20' }, { start: '15:20', end: '18:00' }], // Jueves [cite: 17]
            [cite_start]5: [{ start: '06:45', end: '15:15' }] // Viernes [cite: 17]
            // Sábados y Domingos no están definidos, por lo tanto, no se consideran días laborables
        };
        /**
         * [cite_start]Calcula el total de segundos laborables entre dos fechas y horas. [cite: 18]
         * [cite_start]@param {Date} startDateTime - La fecha y hora de inicio. [cite: 19]
         * [cite_start]@param {Date} endDateTime - La fecha y hora de fin. [cite: 20]
         * [cite_start]@returns {number} El total de segundos laborables. [cite: 21]
         */
        function calculateTotalWorkingSeconds(startDateTime, endDateTime) {
            [cite_start]let totalSeconds = 0; [cite: 21]
            // Clonar las fechas para evitar modificar las originales
            [cite_start]let currentDay = new Date(startDateTime); [cite: 22]
            // Normalizar a la medianoche del día actual para la iteración
            [cite_start]currentDay.setHours(0, 0, 0, 0); [cite: 23]
            const endTarget = new Date(endDateTime); [cite_start]// La hora de finalización exacta [cite: 24]

            // Iterar día a día desde la fecha de inicio hasta la fecha de fin
            while (currentDay.getTime() <= endTarget.getTime()) {
                [cite_start]const dayOfWeek = currentDay.getDay(); [cite: 24]

                [cite_start]// Si es un día laborable según los turnos definidos [cite: 25]
                [cite_start]if (workingShifts[dayOfWeek]) { [cite: 25]
                    [cite_start]workingShifts[dayOfWeek].forEach(shift => { [cite: 25]
                        [cite_start]// Crear objetos Date para el inicio y fin del turno en el día actual [cite: 26]
                        [cite_start]let shiftStartToday = new Date(currentDay); [cite: 26]
                        [cite_start]shiftStartToday.setHours(parseInt(shift.start.split(':')[0]), parseInt(shift.start.split(':')[1]), 0, 0); [cite: 26]

                        [cite_start]let shiftEndToday = new Date(currentDay); [cite: 27]
                        [cite_start]shiftEndToday.setHours(parseInt(shift.end.split(':')[0]), parseInt(shift.end.split(':')[1]), 0, 0); [cite: 27]

                        [cite_start]// Calcular la intersección entre el rango de tiempo general [cite: 27]
                        // (startDateTime, endDateTime) y el turno de trabajo (shiftStartToday, shiftEndToday)
                        [cite_start]const effectiveStart = Math.max(shiftStartToday.getTime(), startDateTime.getTime()); [cite: 28]
                        [cite_start]const effectiveEnd = Math.min(shiftEndToday.getTime(), endTarget.getTime()); [cite: 29]

                        // Si hay una superposición de tiempo, añadir los segundos laborables
                        [cite_start]if (effectiveEnd > effectiveStart) { [cite: 29]
                            [cite_start]totalSeconds += (effectiveEnd - effectiveStart) / 1000; [cite: 29]
                        }
                    });
                }

                [cite_start]// Mover al siguiente día [cite: 31]
                [cite_start]currentDay.setDate(currentDay.getDate() + 1); [cite: 31]
                [cite_start]// Asegurarse de que sea el inicio del siguiente día [cite: 32]
                [cite_start]currentDay.setHours(0, 0, 0, 0); [cite: 32]
            }

            [cite_start]// Asegurarse de que el total de segundos no sea negativo y redondear hacia abajo [cite: 33]
            [cite_start]return Math.max(0, Math.floor(totalSeconds)); [cite: 33]
        }

        /**
         * [cite_start]Actualiza la visualización de la cuenta atrás. [cite: 34]
         */
        function updateCountdown() {
            [cite_start]const now = new Date(); [cite: 35, 36]
            // Obtener la fecha y hora actual

            [cite_start]// Si la fecha actual es igual o posterior a la fecha de destino, la cuenta atrás ha terminado [cite: 36]
            [cite_start]if (now.getTime() >= targetDate) { [cite: 36]
                [cite_start]displayRemainingTime(0); [cite: 37]
                // Mostrar 0 en todos los campos
                [cite_start]clearInterval(countdownInterval); [cite: 37]
                // Detener la actualización
                [cite_start]countdownEl.classList.add("hidden"); [cite: 38]
                // Ocultar la cuenta atrás
                [cite_start]messageEl.classList.remove("hidden"); [cite: 39]
                // Mostrar el mensaje final
                messageEl.innerHTML = 'Enhorabuena, disfruta de tus merecidas vacaciones. Cuidado con los excesos. <a href="https://fmapps2025.github.io/Fapps/vacaciones.html" class="text-emerald-400 hover:underline">Click en este enlace para saber cuántas horas de vacaciones te quedan</a>';
                [cite_start]generateIdeasBtn.classList.remove("hidden"); [cite: 40]
                // Mostrar el botón de generar ideas
                [cite_start]return; [cite: 41]
                // Salir de la función
            }

            [cite_start]// Calcular el total de segundos laborables restantes [cite: 42]
            [cite_start]const remainingTotalWorkingSeconds = calculateTotalWorkingSeconds(now, new Date(targetDate)); [cite: 42]
            [cite_start]// Convertir a milisegundos para calcular las décimas de segundo [cite: 43]
            [cite_start]const remainingTotalWorkingMilliseconds = remainingTotalWorkingSeconds * 1000; [cite: 43]
            [cite_start]// Mostrar el tiempo restante en el HTML [cite: 44]
            [cite_start]displayRemainingTime(remainingTotalWorkingMilliseconds); [cite: 44]
        }

        /**
         * [cite_start]Formatea y muestra el tiempo restante en los elementos HTML. [cite: 45]
         * [cite_start]@param {number} totalMilliseconds - El total de milisegundos laborables. [cite: 46]
         */
        function displayRemainingTime(totalMilliseconds) {
            [cite_start]// Calcular horas, minutos, segundos y décimas de segundo [cite: 47]
            [cite_start]const hours = Math.floor(totalMilliseconds / (1000 * 60 * 60)); [cite: 47]
            [cite_start]totalMilliseconds %= (1000 * 60 * 60); [cite: 48]

            [cite_start]const minutes = Math.floor(totalMilliseconds / (1000 * 60)); [cite: 48]
            [cite_start]totalMilliseconds %= (1000 * 60); [cite: 48]
            [cite_start]const seconds = Math.floor(totalMilliseconds / 1000); [cite: 49]
            [cite_start]totalMilliseconds %= 1000; [cite: 49]

            [cite_start]const tenths = Math.floor(totalMilliseconds / 100); [cite: 49, 50]
            // Obtener la primera décima

            // Actualizar los elementos HTML con los valores calculados, con formato de dos dígitos para horas, minutos y segundos
            [cite_start]hoursEl.innerHTML = String(hours).padStart(2, '0'); [cite: 50]
            [cite_start]minutesEl.innerHTML = String(minutes).padStart(2, '0'); [cite: 51]
            [cite_start]secondsEl.innerHTML = String(seconds).padStart(2, '0'); [cite: 51]
            [cite_start]tenthsEl.innerHTML = String(tenths); [cite: 51, 52]
            // Las décimas no necesitan padStart
        }

        /**
         * [cite_start]Llama a la API de Gemini para generar ideas de celebración. [cite: 52]
         */
        async function generateCelebrationIdeas() {
            [cite_start]loadingIndicator.classList.remove("hidden"); [cite: 53]
            // Mostrar indicador de carga
            [cite_start]ideasOutput.innerHTML = ''; [cite: 54]
            // Limpiar ideas anteriores
            [cite_start]ideasContainer.classList.remove("hidden"); [cite: 55]
            // Asegurarse de que el contenedor de ideas sea visible

            [cite_start]const prompt = "Genera 3 ideas creativas y divertidas para celebrar unas vacaciones que acaban de comenzar. Las ideas deben ser concisas y entusiastas, presentadas como una lista numerada."; [cite: 56]
            [cite_start]let chatHistory = []; [cite: 57]
            [cite_start]chatHistory.push({ role: "user", parts: [{ text: prompt }] }); [cite: 57]

            [cite_start]const payload = { contents: chatHistory }; [cite: 57]
            const apiKey = ""; [cite_start]// La API key será proporcionada por el entorno de Canvas [cite: 58]
            [cite_start]const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`; [cite: 58]
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    [cite_start]body: JSON.stringify(payload) [cite: 59]
                });
                [cite_start]const result = await response.json(); [cite: 60]
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    [cite_start]const text = result.candidates[0].content.parts[0].text; [cite: 61]
                    ideasOutput.innerHTML = text.replace(/\n/g, '<br>'); [cite_start]// Mostrar el texto con saltos de línea [cite: 62]
                } else {
                    [cite_start]ideasOutput.innerHTML = "No se pudieron generar ideas. Inténtalo de nuevo."; [cite: 62]
                }
            } catch (error) {
                [cite_start]console.error("Error al llamar a la API de Gemini:", error); [cite: 63]
                [cite_start]ideasOutput.innerHTML = "Error al conectar con el servicio de ideas."; [cite: 64]
            } finally {
                [cite_start]loadingIndicator.classList.add("hidden"); [cite: 65]
                // Ocultar indicador de carga
            }
        }

        // Event listener para el botón de generar ideas
        [cite_start]generateIdeasBtn.addEventListener("click", generateCelebrationIdeas); [cite: 66]
        [cite_start]// Actualizar la cuenta atrás cada 100 milisegundos para mostrar las décimas de segundo [cite: 67]
        [cite_start]const countdownInterval = setInterval(updateCountdown, 100); [cite: 67]
        [cite_start]// Llamar a la función una vez al cargar la página para evitar un retraso inicial [cite: 68]
        [cite_start]updateCountdown(); [cite: 68]
    </script>
</body>
</html>
